<div class="page-wrapper">
  <mat-card class="page-card">
    <div class="page-header">
      <div>
        <h2 class="page-title">Habitaciones disponibles</h2>
        <p class="page-subtitle">
          Filtra por tipo, precio y capacidad para encontrar la habitación ideal.
        </p>
      </div>
    </div>

    <!-- Filtros -->
    <form [formGroup]="filterForm" class="filters-form">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Tipo</mat-label>
        <mat-select formControlName="type">
          <mat-option value="">Todos</mat-option>
          <mat-option *ngFor="let t of roomTypes" [value]="t">{{ t }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Precio mínimo</mat-label>
        <input matInput type="number" formControlName="minPrice" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Precio máximo</mat-label>
        <input matInput type="number" formControlName="maxPrice" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Capacidad mínima</mat-label>
        <input matInput type="number" formControlName="minCapacity" />
      </mat-form-field>

      <mat-checkbox formControlName="onlyAvailable">
        Solo activas
      </mat-checkbox>
    </form>

    <!-- Loading -->
    <div class="loading-container" *ngIf="loading">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>

    <!-- Sin resultados -->
    <div class="state-message" *ngIf="!loading && rooms.length === 0">
      No se encontraron habitaciones con esos filtros.
    </div>

    <!-- Tabla -->
    <table
      mat-table
      [dataSource]="rooms"
      class="mat-elevation-z2"
      *ngIf="!loading && rooms.length > 0"
    >
      <!-- Imagen -->
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef> Imagen </th>
        <td mat-cell *matCellDef="let room">
          <img
            *ngIf="room.imageUrls && room.imageUrls.length > 0"
            [src]="room.imageUrls[0]"
            [alt]="room.name"
            class="table-image"
          />
        </td>
      </ng-container>

      <!-- Nombre -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Nombre </th>
        <td mat-cell *matCellDef="let room">
          <div class="room-name-cell">
            <span class="room-name">{{ room.name }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Tipo (si quieres mantener la columna separada, déjala) -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> Tipo </th>
        <td mat-cell *matCellDef="let room">{{ room.type }}</td>
      </ng-container>

      <!-- Precio -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef> Precio / noche </th>
        <td mat-cell *matCellDef="let room">
          <span class="room-price">
            {{ room.pricePerNight | currency:'GTQ':'symbol':'1.0-0' }}
          </span>
        </td>
      </ng-container>

      <!-- Capacidad -->
      <ng-container matColumnDef="capacity">
        <th mat-header-cell *matHeaderCellDef> Capacidad </th>
        <td mat-cell *matCellDef="let room">
          {{ room.capacity }} personas
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> </th>
        <td mat-cell *matCellDef="let room">
          <button
            mat-stroked-button
            color="primary"
            [routerLink]="['/rooms', room.id]"
          >
            Ver detalles / Reservar
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[3, 6, 9, 12]"
      (page)="onPageChange($event)"
    >
    </mat-paginator>
  </mat-card>
</div>
