<div *ngIf="loadingRoom" class="loading-container">
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
</div>

<div *ngIf="!loadingRoom && room" class="room-detail-wrapper">
  <mat-card class="room-card">
    <div class="room-header">
      <div>
        <h2>{{ room.name }}</h2>
        <p>{{ room.type }} Â· {{ room.capacity }} personas</p>
        <p>
          <strong>{{ room.pricePerNight | currency:'GTQ':'symbol':'1.0-0' }}</strong>
          por noche
        </p>
      </div>

      <img
        *ngIf="room.imageUrls && room.imageUrls.length > 0"
        [src]="room.imageUrls[0]"
        alt="{{ room.name }}"
        class="room-main-image" />
    </div>

    <div class="amenities" *ngIf="room.amenities && room.amenities.length">
      <h3>Amenidades</h3>
      <div class="amenities-list">
        <span class="amenity" *ngFor="let a of room.amenities">{{ a }}</span>
      </div>
    </div>

    <mat-divider></mat-divider>

    <h3>Reservar</h3>

    <form [formGroup]="form" (ngSubmit)="submitReservation()" class="reservation-form">
      <mat-form-field appearance="outline">
        <mat-label>Fecha de entrada</mat-label>
        <input matInput [matDatepicker]="pickerIn" formControlName="checkIn" />
        <mat-datepicker-toggle matSuffix [for]="pickerIn"></mat-datepicker-toggle>
        <mat-datepicker #pickerIn></mat-datepicker>
        <mat-error *ngIf="form.controls.checkIn.hasError('required')">
          Selecciona una fecha de entrada
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Fecha de salida</mat-label>
        <input matInput [matDatepicker]="pickerOut" formControlName="checkOut" />
        <mat-datepicker-toggle matSuffix [for]="pickerOut"></mat-datepicker-toggle>
        <mat-datepicker #pickerOut></mat-datepicker>
        <mat-error *ngIf="form.controls.checkOut.hasError('required')">
          Selecciona una fecha de salida
        </mat-error>
        <mat-error *ngIf="form.hasError('dateRange')">
          La fecha de salida debe ser posterior a la entrada
        </mat-error>
      </mat-form-field>

      <div class="price-preview" *ngIf="nights && totalPrice">
        <p>Noches: <strong>{{ nights }}</strong></p>
        <p>Total: <strong>{{ totalPrice | currency:'GTQ':'symbol':'1.0-0' }}</strong></p>
      </div>

      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="creating || form.invalid">
        <mat-progress-spinner
          *ngIf="creating"
          mode="indeterminate"
          [diameter]="20"
          class="btn-spinner">
        </mat-progress-spinner>
        <span *ngIf="!creating">Confirmar reserva</span>
      </button>
    </form>
  </mat-card>
</div>
